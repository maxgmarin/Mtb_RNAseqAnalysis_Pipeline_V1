# M. tuberculosis RNA-seq pipeline development notes

### Maximillian Marin





# Creating  Directory in laptop's documents directory

mkdir ~/Documents/FarhatLab


cd ~/Documents/FarhatLab

# GitHub_Repo_URL="https://github.com/maxgmarin/Mtb_RNAseqAnalysis_Pipeline_V1"
# git clone ${GitHub_Repo_URL}

git clone https://github.com/maxgmarin/Mtb_RNAseqAnalysis_Pipeline_V1

# Organize GitHub Repo Directories

# Useful Links: 
1) https://stackoverflow.com/questions/27702452/loop-through-a-comma-separated-shell-variable
2) http://www.tldp.org/LDP/abs/html/string-manipulation.html


### Make Directories:

GitRepoDir="/home/mgmarin/Documents/FarhatLab/Mtb_RNAseqAnalysis_Pipeline_V1" 

cd ${GitRepoDir}

listOf_DIRs="JupyterNotebooks, Notes, envs, scripts, runInfo_TSVs, References"

for dir_name in ${listOf_DIRs//,/ }
do
    echo "${dir_name}"
    mkdir ${GitRepoDir}/${dir_name}
    touch ${GitRepoDir}/${dir_name}/${dir_name}_README.md
done


mkdir ${GitRepoDir}/References/LargeReferences

# Create README

touch ${GitRepoDir}/README.md
touch ${GitRepoDir}/.gitignore



# Let's create an environment for FeatureCounts using conda & bioconda

# Create "subread_featurecounts_2_0_1" conda environment (On O2)




conda create -n subread_featurecounts_2_0_1 subread=2.0.1-0

# Export to YAML file

Farhat_Lab_Dir="/n/data1/hms/dbmi/farhat"
Mtb_RNAseq_SM_Dir="${Farhat_Lab_Dir}/mm774/Snakemake_Pipelines/Mtb_RNAseqAnalysis_Pipeline_V1"

cd ${Mtb_RNAseq_SM_Dir}
conda activate subread_featurecounts_2_0_1

conda env export > subread_featurecounts_2_0_1_Conda.yml









# Running on O2 (on the lineage 8 Mtb isolate)

# ssh mm774@login01.o2.rc.hms.harvard.edu (And then open a SCREEN)
# srun -p medium --pty -n 1 --mem 2G -t 1-23:59 /bin/bash

# srun -p short --pty -n 1 --mem 2G -t 0-11:59 /bin/bash


Farhat_Lab_Dir="/n/data1/hms/dbmi/farhat"


Mtb_RNAseq_SM_Dir="${Farhat_Lab_Dir}/mm774/Snakemake_Pipelines/Mtb_RNAseqAnalysis_Pipeline_V1"


inputConfigFile="${Mtb_RNAseq_SM_Dir}/config_PMP_V6.json"

input_SampleInfo_TSV="${Mtb_RNAseq_SM_Dir}/runInfo/PRJNA508198_SraRunTable.csv"




targetOutput_Dir="${Farhat_Lab_Dir}/mm774/Projects/Mtb_RNAseq_Analysis/Mtb_RNAseqAnalysis_Pipeline_Outputs/200610_MtbRNAseq_SM_PRJNA508198_TestRun_V1_Output"

mkdir -p ${targetOutput_Dir}








cd ${Mtb_RNAseq_SM_Dir}

snakemake -s Mtb_RNAseq_SM_V1.py --config output_dir=${targetOutput_Dir} inputSampleData_TSV=${input_SampleInfo_TSV} --configfile ${inputConfigFile} -np 


snakemake -s Mtb_RNAseq_SM_V1.py --config output_dir=${targetOutput_Dir} inputSampleData_TSV=${input_SampleInfo_TSV} --configfile ${inputConfigFile} -np --dag --use-conda | dot -Tsvg > DAGs/TestRunV7_Lin8Sample_WiFlye_dag.svg



## Run on O2

mkdir -p ${targetOutput_Dir}/O2logs/cluster/

snakemake -s Mtb_RNAseq_SM_V1.py --config output_dir=${targetOutput_Dir} inputSampleData_TSV=${input_SampleInfo_TSV} --configfile ${inputConfigFile} -p --use-conda -j 400 --cluster-config clusterConfig_PMP_V5.json --cluster "sbatch -p {cluster.p} -n {cluster.n}  -t {cluster.t} --mem {cluster.mem} -o ${targetOutput_Dir}/{cluster.o} -e ${targetOutput_Dir}/{cluster.e}" --latency-wait 20 -k 






















